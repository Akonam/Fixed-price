---
title: "DoD Fixed-Price Study: Procedural Competition classification"
author: "Greg Sanders"
date: "Tuesday, January 13, 2015"
output:
  html_document:
    keep_md: yes
---

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the [exploration on R&D](RnD_1to5_exploration.md), we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

##Studying Competitive  contracts in the sample.
One important factor for this study is whether a contract was available for competition. Unlike other CSIS work, we are not considering the numbers of offers received, as that is a dependent variable for the purposes of this study.

```{r setup, echo = TRUE}
require(ggplot2)
require(stringr)
require(plyr)
options(error=recover)
# setwd("K:\\Development\\Fixed-price")
setwd("C:\\Users\\Greg Sanders\\Documents\\Development\\Fixed-price")
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
source(paste(Path,"lookups.r",sep=""))

contract.sample  <- read.csv(
    paste("data\\defense_contract_CSIScontractID_sample_15000_SumofObligatedAmount.csv", sep = ""),
    header = TRUE, sep = ",", dec = ".", strip.white = TRUE, 
    na.strings = c("NULL","NA",""),
    stringsAsFactors = FALSE
    )

contract.sample$pIsSomeCompetition <- contract.sample$ObligatedAmountIsSomeCompetition/contract.sample$ObligatedAmount
contract.sample$pIsSomeCompetition[is.na(contract.sample$ObligatedAmountIsSomeCompetition)] <- 0

# statutoryexceptiontofairopportunity
# extentcompeted        '
# UnmodifiedNumberOfOffersReceived
# IsFullAndOpen
# IsSomeCompetition        
# IsOnlyOneSource
# IsFollowonToCompetedAction
# numberofoffersreceived

contract.sample$firstSignedDateRnD1to5 <- strptime(contract.sample$firstSignedDateRnD1to5, "%Y-%m-%d")
contract.sample$MinOfEffectiveDate <- strptime(contract.sample$MinOfEffectiveDate, "%Y-%m-%d")
contract.sample<-apply_lookups(Path,contract.sample)
# 
# 
# ggplot(
#     data = subset(contract.sample),
#     aes_string(x = "statutoryexceptiontofairopportunity"),
#     main = "Distribution by statutory exception to fair opportunity"
#     ) +
#     geom_bar()
# 
# 
# ggplot(
#     data = subset(contract.sample),
#     aes_string(x = "statutoryexceptiontofairopportunity"),
#     main = "Distribution by statutory exception to fair opportunity"
#     ) +
#     geom_bar()
# 
# ggplot(
#     data = subset(contract.sample),
#     aes_string(x = "extentcompeted"),
#     main = "Distribution by extent competed"
#     ) +
#     geom_bar() #+binwidth = 0.05 + 
# #     facet_grid( statutoryexceptiontofairopportunity ~ .,
# #                 scales = "free_y",
# #                 space = "free_y") + scale_y_continuous(expand = c(0,50)) 
# ObligatedAmountIsSomeCompetition

ggplot(
    data = subset(contract.sample),
    aes_string(x = "IsOnlyOneSource"),
    main = "Distribution by is full and open"
    ) +
    geom_bar(binwidth=1)
# +     facet_grid( IsFullAndOpen ~ .,
#               scales = "free_y",
#               space = "free_y") + scale_y_continuous(expand = c(0,50)) 

ggplot(
    data = contract.sample,
    aes_string(x = "pIsSomeCompetition"),
    main = "Distribution by is full and open"
    ) +
    geom_bar(binwidth=0.05)+     
        facet_grid(  UnmodifiedIsSomeCompetition ~ .,
              scales = "free_y",
              space = "free_y") + scale_y_continuous(expand = c(0,500)) +
         theme(strip.text.y  = element_text(angle = 360)
          )

ggplot(
    data = subset(contract.sample),
    aes_string(x = "IsOnlyOneSource"),
    main = "Distribution by is full and open"
    ) +
    geom_bar(binwidth=1)
# +     facet_grid( IsFullAndOpen ~ .,
#               scales = "free_y",
#               space = "free_y") + scale_y_continuous(expand = c(0,50)) 


ggplot(
    data = subset(contract.sample),
    aes_string(x = "IsSomeCompetition",fill="UnmodifiedIsSomeCompetition"),
    main = "Distribution by is full and open"
    ) +
    geom_bar(binwidth=1)
# +     facet_grid( IsFullAndOpen ~ .,
#               scales = "free_y",
#               space = "free_y") + scale_y_continuous(expand = c(0,50)) 


ggplot(
    data = subset(contract.sample),
    aes_string(x = "UnmodifiedIsSomeCompetition"),
    main = "Distribution by is some competition"
    ) +
    geom_bar(binwidth=1)+     
        facet_grid( . ~  IsSomeCompetition,
              scales = "free_y",
              space = "free_y") + scale_y_continuous(expand = c(0,500)) +
         theme(strip.text.y  = element_text(angle = 360)
          )


```

The distribution of the number of offers received. For the chart below, we've cut out the instances where more than one hundred offers were received. Notably if the competition and no competition categries are combined, the distribution is fully exponential. That is still largely true for competed entries, although it the number receiving single offer competition is lower than the number receiving competition with multiple offers.

```{r UnmodifiedNumOffers}
ggplot(
    data = subset(contract.sample,UnmodifiedNumberOfOffersReceived<100),
    aes_string(x = "UnmodifiedNumberOfOffersReceived"),
    main = "Distribution by Number Of Offers Received (1 to 100)"
    ) +
    geom_bar(binwidth = 1)
# + 
#     facet_grid( IsSomeCompetition ~ .,
#                 scales = "free_y",
#                 space = "free_y") + scale_y_continuous(expand = c(0,50)) 


ggplot(
    data = subset(contract.sample,UnmodifiedNumberOfOffersReceived<100),
    aes_string(x = "UnmodifiedNumberOfOffersReceived"),
    main = "Distribution by Number Of Offers Received (1 to 100)"
    ) +
    geom_bar(binwidth = 1) + 
    facet_grid( IsSomeCompetition ~ .,
                scales = "free_y",
                space = "free_y") + scale_y_continuous(expand = c(0,50)) 

ggplot(
    data = subset(contract.sample,NumberOfOffersReceived<100),
    aes_string(x = "UnmodifiedNumberOfOffersReceived"),
    main = "Distribution by Number Of Offers Received (1 to 100)"
    ) +
    geom_bar(binwidth = 1)
# + 
#     facet_grid( IsSomeCompetition ~ .,
#                 scales = "free_y",
#                 space = "free_y") + scale_y_continuous(expand = c(0,50)) 

ggplot(
    data = subset(contract.sample,NumberOfOffersReceived<100),
    aes_string(x = "UnmodifiedNumberOfOffersReceived"),
    main = "Distribution by Number Of Offers Received (1 to 100)"
    ) +
    geom_bar(binwidth = 1) + 
    facet_grid( IsSomeCompetition ~ .,
                scales = "free_y",
                space = "free_y") + scale_y_continuous(expand = c(0,50)) 


```



Number of offers received and unmodified number of offers received appear to be the same. That's probably a mistake.


```{r NumOffers}
ggplot(
    data = subset(contract.sample,numberofoffersreceived<100),
    aes_string(x = "numberofoffersreceived"),
    main = "Distribution by Unmodified Number Of Offers Received (1 to 100)"
    ) +
    geom_bar(binwidth = 1)+     facet_grid( IsSomeCompetition ~ .,
                                            scales = "free_y",
                                            space = "free_y") + scale_y_continuous(expand = c(0,50)) 


```




